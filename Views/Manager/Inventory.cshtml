@{
    ViewBag.Title = "Inventory Overview";
}

<div class="dashboard-wrapper">
    <div class="dashboard-card">

        <div class="dashboard-header">

            <h2 class="text-center mt-4">Inventory Overview</h2>

            <div class="mb-3 d-flex justify-content-between">
                <a href="/Manager/Index" class="btn btn-outline-warning">
                    Back
                </a>
            </div>
        </div>

        <table id="inventoryTable" class="table table-bordered table-striped">
            <thead>
                <tr>
                    <th>Product</th>
                    <th>Warehouse</th>
                    <th>Available Quantity</th>
                </tr>
            </thead>
            <tbody id="tableContainer"></tbody>
        </table>
    </div>
</div>


@section scripts{
    <script>

        let table = null;

        $(document).ready(function () {
            loadInventory();
        });

        // ---------------- FETCH DATA ----------------
        function loadInventory() {
            if (table !== null) {
                table.destroy();
                $("#tableContainer").empty();
            }

            $.ajax({
                url: "/Manager/GetInventory",
                type: "GET",
                success: function (res) {
                    renderInventory(res.data || res);
                    initializeDataTable(); 
                },
                error: function () {
                    alert("Unable to load inventory");
                }
            });
        }

        // ---------------- JS MODEL ----------------
        function InventoryModel(obj) {
            this.ProductName = obj.ProductName;
            this.WarehouseName = obj.WarehouseName;
            this.Quantity = obj.Quantity;
        }

        function getQuantityBadge(qty) {

            if (qty == 0)
                return `<span class="badge bg-danger fs-6">Out of Stock</span>`;

            if (qty <= 3)
                return `<span class="badge bg-warning fs-6">${qty}</span>`;

            return `<span class="badge bg-info fs-6">${qty}</span>`;
        }

        // ---------------- RENDER TABLE ----------------
        function renderInventory(data) {

            let container = $("#tableContainer");
            container.empty();

            if (!data || data.length === 0) {
                container.append(`<tr><td colspan="3" class="text-center">No inventory found</td></tr>`);
                return;
            }

            data.forEach(function (item) {

                let inv = new InventoryModel(item);

                let html = `
            <tr>
                <td>${inv.ProductName}</td>
                <td>${inv.WarehouseName}</td>
                <td>${getQuantityBadge(inv.Quantity)}</td>
            </tr>
        `;

                container.append(html);
            });
        }

        // ---------------- DATATABLE INIT ----------------
        function initializeDataTable() {

            table = $('#inventoryTable').DataTable({
                paging: true,
                searching: true,
                ordering: true,
                info: true,
                pageLength: 5,
                lengthMenu: [5, 10, 25, 50],

                language: {
                    search: "🔍 Search Product:",
                    lengthMenu: "Show _MENU_ entries",
                    info: "Showing _START_ to _END_ of _TOTAL_ records",
                    emptyTable: "No inventory available"
                }
            });
        }

    </script>
}


<style>
    /* ===== PAGE BACKGROUND ===== */
    body {
        background: linear-gradient(135deg, #1e3c72, #2a5298);
        font-family: 'Segoe UI', sans-serif;
    }

    /* ===== WRAPPER ===== */
    .dashboard-wrapper {
        min-height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 30px;
    }

    /* ===== MAIN CARD ===== */
    .dashboard-card {
        width: 95%;
        max-width: 1100px;
        background: #ffffff;
        padding: 30px;
        border-radius: 15px;
        box-shadow: 0 15px 40px rgba(0, 0, 0, 0.2);
    }

    /* ===== HEADER ===== */
    .dashboard-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 25px;
    }

        .dashboard-header h2 {
            font-weight: 600;
            color: #333;
        }

    /* ===== TABLE ===== */
    .custom-table {
        border-radius: 12px;
        overflow: hidden;
    }

        .custom-table thead {
            background: #f4f6f9;
            font-weight: 600;
        }

        .custom-table tbody tr {
            transition: 0.2s ease-in-out;
        }

            .custom-table tbody tr:hover {
                background-color: #f1f5ff;
            }

    /* ===== STATUS BADGES ===== */
    .text-success {
        background-color: #e6f9f0;
        padding: 4px 10px;
        border-radius: 20px;
    }

    .text-danger {
        background-color: #ffe6e6;
        padding: 4px 10px;
        border-radius: 20px;
    }

    .text-warning {
        background-color: #fff4e6;
        padding: 4px 10px;
        border-radius: 20px;
    }

    /* ===== DROPDOWN ===== */
    .status-dropdown {
        border-radius: 20px;
        padding: 4px 10px;
        margin-right: 8px;
    }

    /* ===== UPDATE BUTTON ===== */
    .update-btn {
        border-radius: 20px;
        padding: 4px 12px;
        font-size: 13px;
    }

    /* ===== DATATABLE SEARCH BOX ===== */
    .dataTables_filter input {
        border-radius: 20px !important;
        padding: 6px 15px !important;
        border: 1px solid #ccc !important;
    }

    /* ===== PAGINATION ===== */
    .dataTables_paginate .paginate_button {
        border-radius: 50px !important;
        margin: 2px !important;
    }
</style>
